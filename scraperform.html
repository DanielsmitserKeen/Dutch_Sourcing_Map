<script>
  // Initialize Vanta.js background
  VANTA.GLOBE({
    el: "#vanta-bg",
    mouseControls: true,
    touchControls: true,
    gyroControls: false,
    minHeight: 200.00,
    minWidth: 200.00,
    scale: 1.00,
    scaleMobile: 1.00,
    color: 0x3b82f6,
    backgroundColor: 0xf8fafc,
    size: 0.8
  });

  // Initialize feather icons
  feather.replace();

  // ----- INDUSTRY CHIP LOGIC -----
  const selectedIndustries = [];
  const industriesInput = document.getElementById('industriesInput');
  const industryChips = document.getElementById('industryChips');

  function toggleIndustry(industry) {
    const index = selectedIndustries.indexOf(industry);
    if (index === -1) {
      selectedIndustries.push(industry);
    } else {
      selectedIndustries.splice(index, 1);
    }
    updateIndustryChips();
    industriesInput.value = selectedIndustries.join(',');
  }

  function updateIndustryChips() {
    industryChips.innerHTML = '';
    selectedIndustries.forEach(industry => {
      const chip = document.createElement('div');
      chip.className = 'inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm';
      chip.innerHTML = `${industry} <button onclick="removeIndustry('${industry}')" class="ml-1 text-blue-600 hover:text-blue-800">&times;</button>`;
      industryChips.appendChild(chip);
    });

    if (selectedIndustries.length === 0) {
      const placeholder = document.createElement('div');
      placeholder.className = 'text-gray-500 text-sm';
      placeholder.textContent = 'No industries selected';
      industryChips.appendChild(placeholder);
    }
  }

  function removeIndustry(industry) {
    const index = selectedIndustries.indexOf(industry);
    if (index !== -1) {
      selectedIndustries.splice(index, 1);
      updateIndustryChips();
      industriesInput.value = selectedIndustries.join(',');
    }
  }

  function addCustomIndustry() {
    const input = document.getElementById('customIndustryInput');
    const value = input.value.trim();
    if (value && !selectedIndustries.includes(value)) {
      selectedIndustries.push(value);
      updateIndustryChips();
      industriesInput.value = selectedIndustries.join(',');
      input.value = ''; // clear input
    }
  }

  // ----- COUNTRY CHIP LOGIC -----
  const selectedCountries = [];
  const countriesInput = document.getElementById('countriesInput');
  const countryChips = document.getElementById('countryChips');

  function toggleCountry(country) {
    const index = selectedCountries.indexOf(country);
    if (index === -1) {
      selectedCountries.push(country);
    } else {
      selectedCountries.splice(index, 1);
    }
    updateCountryChips();
    countriesInput.value = selectedCountries.join(',');
  }

  function updateCountryChips() {
    countryChips.innerHTML = '';
    selectedCountries.forEach(country => {
      const chip = document.createElement('div');
      chip.className = 'inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm';
      chip.innerHTML = `${country} <button onclick="removeCountry('${country}')" class="ml-1 text-green-600 hover:text-green-800">&times;</button>`;
      countryChips.appendChild(chip);
    });

    if (selectedCountries.length === 0) {
      const placeholder = document.createElement('div');
      placeholder.className = 'text-gray-500 text-sm';
      placeholder.textContent = 'No countries selected';
      countryChips.appendChild(placeholder);
    }
  }

  function removeCountry(country) {
    const index = selectedCountries.indexOf(country);
    if (index !== -1) {
      selectedCountries.splice(index, 1);
      updateCountryChips();
      countriesInput.value = selectedCountries.join(',');
    }
  }

  // ----- SUBSTACK MANAGER -----
  const webhookUrl = "https://danielsmitserkeen.app.n8n.cloud/webhook/38add8c0-f1e3-4c96-a923-204772eee281"; 

  async function sendLinks() {
    const textarea = document.getElementById("linksTextarea");
    const links = textarea.value
      .split("\n")
      .map(l => l.trim())
      .filter(l => l !== "");

    if (links.length === 0) {
      alert("Please enter at least one link.");
      return;
    }

    try {
      await fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ links })
      });

      // Success message
      const notification = document.createElement("div");
      notification.className =
        "fixed bottom-4 right-4 px-4 py-2 bg-green-500 text-white rounded-lg shadow-lg flex items-center";
      notification.innerHTML = `
        <i data-feather="check-circle" class="mr-2"></i>
        Links sent successfully
      `;
      document.body.appendChild(notification);
      feather.replace();

      setTimeout(() => notification.remove(), 3000);
      textarea.value = ""; // clear after sending
    } catch (err) {
      console.error("Error sending links:", err);
      alert("Failed to send links. Check console.");
    }
  }
</script>
